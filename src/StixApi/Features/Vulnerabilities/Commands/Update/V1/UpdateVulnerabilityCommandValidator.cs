using FluentValidation;
using StixApi.Features.Vulnerabilities.Models;

namespace StixApi.Features.Vulnerabilities.Commands.Update.V1;

public class UpdateVulnerabilityCommandValidator : AbstractValidator<UpdateVulnerabilityCommand>
{
    public UpdateVulnerabilityCommandValidator()
    {
        RuleFor(v => v.Id)
            .NotEmpty().WithMessage("id is required")
            .Matches(@"^vulnerability--[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$")
            .WithMessage("Id must follow the pattern: vulnerability--GUID");

        RuleFor(v => v.Revoked)
            .Must(v => v == null || v == true || v == false)
            .WithMessage("revoked must be either true, false, or null");

        RuleFor(v => v.Confidence)
            .Must(v => v == null || v >= 0 && v <= 100)
            .WithMessage("confidence must be between 0 and 100")
            .When(v => v.Confidence != null);
    }
}